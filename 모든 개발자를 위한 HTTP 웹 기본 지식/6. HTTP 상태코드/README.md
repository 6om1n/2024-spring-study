# :star: 6. HTTP 상태코드
## HTTP 상태코드 소개

### 상태 코드 - 클라이언트가 보낸 요청의 처리 상태를 응답에서 알려주는 기능
- 1xx (Informational) : 요청이 수신되어 처리중
- 2xx (Successful) :  요청 정상 처리
- 3xx (Redirection) : 요청을 완료하려면 추가 행동이 필요
- 4xx (Client Error) : 클라이언트 오류, 잘못된 문법 등으로 서버가 요청을 수행할 수 없음
- 5xx (Server Error) : 서버 오류, 서버가 정상 요청을 처리하지 못함

### 만약 모르는 상태 코드가 나타난다면 ?
- 클라이언트는 상위 상태코드로 해석해서 처리한다. 
- 미래에 새로운 상태 코드가 추가되어도 클라이언트를 변경하지 않아도 된다. 
- 예를 들어 299 는 2xx (Successful) 로 해석되어 처리된다. 

### 1xx (Informational) - 요청이 수신되어 처리중
- 해당하는 에러는 거의 사용하지 않으므로 생략된다. 

***

## 2xx - 성공
- 200 OK
- 201  Created
- 202 Accepted
- 204 No Content

### 200 OK 
![image](https://github.com/2024-SpringStudy/spring/assets/78257436/4d1d1398-ae39-4a1a-a92c-83ff6871705f)
> - 요청이 제대로 응답이 될 경우 200 OK를 리턴해준다. 

### 201 Created
![image](https://github.com/2024-SpringStudy/spring/assets/78257436/85e0b782-0d18-4474-8c1d-251b750f01c0)
> - 클라이언트가 요청을 했을 때 서버가 위치를 지정하여 만들게 되면 생성된 리소스는 Location 으로 위치를 알려주고, 201 Created로 요청이 성공되서 새로운 리소스가 생성되었다는 것을 알려준다. 

### 202 Accepted
- 요청이 접수되었으나 처리가 완료되지 않았음을 나타낸다. 
- 배치 처리 같은 곳에서 사용된다.
- 예를 들어 요청 접수 후 1시간 뒤에 배치 프로세스가 요청을 처리하는 경우

### 204 No Content
- 서버가 요청을 성공적으로 수행했지만, 응답 페이로드 본문에 보낼 데이터가 없는 경우
- 예) 웹 문서 편집기에서 save 버튼
- save 버튼의 결과로 아무 내용이 없어도 된다.
- save 버튼을 눌러도 같은 화면을 유지해야 한다. 
- 결과 내용이 없어도 204 메시지 (2xx)만으로 성공을 인식할 수 있다.  
 
***

## 3xx - 리다이렉션1
### 3xx (Redirection) - 요청을 완료하기 위해 유저 에이전트의 추가 조치 필요
- 300 Multiple Choices
- 301 Moved Permanently
- 302 Found
- 303 See Other
- 304 Not Modified
- 307 Temporary Redirect
- 308 Permanent Redirect


- 웹 브라우저는 3xx 응답의 결과에 Location 헤더가 있으면, Location 위치로 자동 이동한다. 그것이 **리다이렉트** 이다. 

![image](https://github.com/2024-SpringStudy/spring/assets/78257436/23c7adb5-a600-4c1d-ab56-477ba474a25e)

> - /event 의 위치로 요청을 했는데, 해당하는 위치가 /new-event 로 옮겨간 경우 그 위치로의 GET 으로 다시 요청을 서버로 보내게 된다. 

### 리다이렉션의 종류
- 영구 리다이렉션 - 특정 리소스의 URI가 영구적으로 이동했을 경우
    - 예) /members -> /users
    - 예) /event -> /new-event
- 일시 리다이랙션 - 일시적인 변경
    - 주문 완료 후 주문 내역 화면으로 이동
    - PRG : Post/Redirect/Get
-  특수 리다이렉션
    - 결과 대신 캐시를 사용

### 영구 리다이렉션 (301, 308)
- 리소스의 URI가 영구적으로 이동했을 경우, 원래의 URIㅇ르 사용하지 않고 검색 엔진 등에서도 변경을 인지했을 때
- **301 Moved Permanently**
    - 리다이렉트시 요청 메서드가 GET으로 변하고, 본문이 제거될 수 있다. 
- **308 Permanent Redirect**
    - 301과 기능은 같다. 
    - 리다이렉트 시 요청 메서드와 본문을 유지한다. (처음 POST를 보내면 리다이렉트도 POST를 유지한다. )

#### 영구 리다이렉션 - 301
![image](https://github.com/2024-SpringStudy/spring/assets/78257436/d3c3c6d3-7f1d-4561-afc9-f28845e679a3)

> - 클라이언트가 POST를 사용해서 요청을 보냈는데 위치가 /new-event 로 옮겨진 경우 301 을 통해서 위치가 옮겨졌다고 알리고, 자동 리다이렉트가 되어 POST가 아닌 GET 으로 메시지를 제거한 후 서버에 전달한다. 

#### 영구 리다이렉션 - 308
![image](https://github.com/2024-SpringStudy/spring/assets/78257436/1e18698e-22eb-4554-8f53-b88335578b73)
> - POST를 사용해서 /event 위치에 요청을 했는데 해당하는 위치가 /new-event 로 변경이 된 경우 자동 리다이렉트되고,  POST를 유지하여 메시지를 유지한 채 새로운 위치에 메시지를 요청하고, 서버로부터 응답을 받는다.
> - 308 은 자주 사용하지 않아 보통 301 을 많이 사용한다.      
   
***

## 3xx - 리다이렉션2

### 일시적인 리다이렉션 (302, 307, 303)
- 리소스의 URI가 일시적으로 변경이 된 경우이다. 
- 따라서 검색 엔진 등에서 URL을 변경하면 안된다. 
- **302 Found**
    - 리다이렉트 시 요청 메서드가 GET으로 변하고, 본문이 제거될 수 있다. 
- **307 Temporary Redirect**
    - 302 와 기능은 같다. 
    - **리다이렉트 시 요청 메서드와 본문을 유지한다. (요청 메서드를 변경하면 안된다. MUST NOT)**  
- **303 See Other**
    - 302와 기능은 같다. 
    - **리다이렉트 시 요청 메서드가 GET으로 변경한다.**

### PRG : POST/ REDIRECT/ GET - 일시적인 리다이렉션 예시
- POST로 주문 후에 웹 브라우저를 새로고침할 경우 중복 주문이 될 수 있다. 

![image](https://github.com/2024-SpringStudy/spring/assets/78257436/4290436b-99fe-415b-8626-33587a9b43bc)

> - /order에 주문 요청을 보내면, 주문 데이터베이스에 마우스 하나를 저장한다. 후에 200 OK 를 클라이언트에 응답한다. 
> - 여기서 실수로 새로 고침을 누르면 마지막 요청이 다시 서버로 요청이 들어가기 때문에 주문이 한 건이 더 들어가는 문제점이 발생한다.    

- 이 문제점을 해결하기 위해 일시적인 리다이렉션을 사용한다. 
- POST로 주문 후에 새로 고침으로 인한 중복 주문을 방지해준다. 
- POST 로 주문 후에 주문 결과 화면을 GET 메서드로 리다이렉트한다.
- 새로고침해도 결과 화면을 GET으로 조회한다. 
- 중복 주문 대신에 결과 화면만 GET으로 다시 요청한다. 

![image](https://github.com/2024-SpringStudy/spring/assets/78257436/2c4302bf-d36e-4d20-9bb0-0590bb94bd2b)
> - PRG를 사용할 경우 /order에 주문 한 건을 넣으면 주문 데이터가 데이터 베이스에 마우스 1개를 저장하고, 실수로 새로 고침을해도 GET으로 서버에 전달이 되어 해당 주문 데이터를 조회하여 중복 주문이 발생하지 않는다. 

- PRG 이후에 리다이렉트를 하면, URL이 이미 POST -> GET 으로 리다이렉트가 된다. 
- 새로 고침해도 GETㅇ로 결과 화면만 조회가 된다. 

## 정리 !
- 잠깐 정리
   - 302 Found -> GET으로 변할 수 있다.
   - 307 Temporary Redirect -> 메서드가 변하면 안된다. 
   - 303 See Other -> 메서드가 GET으로 변경된다.
- 역사
    - 처음 302 스펙의 의도는 HTTP 메서드를 유지하는 것이다. 
    - 그런데 웹 브라우저들이 대부분 GET으로 바꾸어버렸다. 
    - 그래서 모호한 302를 대신하는 명확한 307, 303 이 등장하였다. 
- 현실
    - 307, 303을 권장하지만 현실적으로 이미 많은 애플리케이션 라이브러리들이 302를 기본값으로 사용한다. 
    - 자동 리다이렉션 시에 GET으로 변해도 되면 그냥 302를 사용해도 큰 문제는 없다. 
   
### 기타 리다이렉션 (300, 304)
- 300 Multiple Choices : 안쓴다. 
- 304 Not Modified
    - 캐시를 목적으로 사용한다. 
    - 클라이언트에게 리소스가 수정되지 않았음을 알려준다. 따라서 클라이언트는 로컬PC에 저장된 캐시를 재사용한다. (캐시로 리다이렉트한다. )
    - 304 응답은 응답에 메시지 바디를 포함하면 안된다. (로컬 캐시를 사용해야 하므로)
    - 조건부 GET, HEAD 요청 시 사용한다. 
 
***

## 4xx -클라이언트 오류, 5xx -서버 오류
### 4xx (Client Error) - 클라이언트 오류
- 클라이언트의 요청에 잘못된 문법 등으로 서버가 요청을 수행할 수 없다. 
- **오류의 원인이 클라이언트에 있다.**
- 중요 ! 클라이언트가 이미 잘못된 요청, 데이터를 보내고 있기 때문에, 똑같은 재시도가 실패한다. 
- 잘못의 원인이 클라이언트에 있기 때문에 수정하지 않는 한 오류가 계속 발생한다. 

#### 400 Bad Request - 클라이언트가 잘못된 요청을 해서 서버가 요청을 처리할 수 없음
- 요청 구문, 메시지 등등의 오류
- 클라이언트는 요청 내용을 다시 검토하고, 보내야한다. 
- 예 ) 요청 파라미터가 잘못되거나, API 스펙이 맞지 않을 때

#### 401 Unauthorized - 클라이언트가 해당 리소스에 대한 인증이 필요하다. 
- 인증이 되지 않았을 때 발생한다. 
- 401 요류 발생 시 응답에 WWW-Authenticate 헤더와 함께 인증 방법을 설명
- 참고
    - 인증(Authentication): 본인이 누구인지 확인 (로그인)
    - 인가(Authorization): 권한부여 (ADMIN 권한처럼 특정 리소스에 접근할 수 있는 권한, 인증이 있어야 인가가 있음)
    - 오류 메시지가 Unauthorized 이지만 인증 되지 않음 (이름이 아쉬움)

#### 403 Forbidden - 서버가 요청을 이해했지만 승인을 거부함
- 주로 인증 자격 증명은 있지만, 접근 권한이 불충분 한 경우
- 예) Admin 등급이 아닌 사용자가 로그인은 했지만, Admin 등급의 리소스에 접근하는 경우

#### 404 Not Found - 요청 리소스를 찾을 수 없을 경우
- 요청 리소스가 서버에 없을 경우 발생한다. 
- 또는 클라이언트가 권한이 부족한 리소스에 접근할 때 해당 리소스를 숨기고 싶을 때 발생한다. 

### 5xx (Server Error) - 서버 오류
- 서버 문제로 오류 발생
- 서버에 문제가 있기 때문에 재시도 하면 성공할 수도 있음

#### 500 Internal Server Error - 서버 문제로 오류 발생, 애매하면 500 오류
- 서버 내부 문제로 오류가 발생한다. 
- 애매하면 500 오류를 발생시킨다. 

#### 503 Service Unavailable - 서비스 이용 불가
- 서버가 일시적인 과부하 또는 예정된 작업으로 잠시 요청을 처리할 수 없을 때
- Retry-After 헤더 필드로 얼마 뒤에 복구되는 지 보낼 수도 있다. 

>- 왠만하면 서버 500 대 오류를 발생시키면 안된다. 
> - 진짜 서버에 문제가 발생했을 때 일으켜야한다. 
> - 비즈니스 로직 오류 상 발생하는 문제에서는 발생시키면 안되고, 진짜 서버에 큰 문제가 발생했을 때 500 대 오류를 발생시켜야 한다. 

***

## 🔗출처

- 김영한 - [모든 개발자를 위한 HTTP 웹 기본 지식](https://www.inflearn.com/course/http-웹-네트워크/dashboard)
